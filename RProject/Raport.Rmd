---
title: "Analiza danych w R"
author: "Michal Hejduk"
date: "2 grudnia 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Wstęp

Na początku pliku powinna znajdować się automatycznie wypełniona data generacji dokumentu oraz spis treści pozwalający przejść do najważniejszych sekcji. Ponadto raport powinien zaczynać się od rozdziału podsumowującego całą analizę, streszczającego najważniejsze spostrzeżenia analityka.

#1. Wykorzystane biblioteki
```{r bilbioteki}
library(dplyr)
library(tibble)
library(tidyr)
library(ggplot2)
library(kableExtra)
```



#3.Odczyt danych
```{r dane, results='hide'}
filePath = "C:/Users/micha/Downloads/all_summary.csv"
initial <- read.table(filePath, nrows = 100, sep = ";", header = TRUE)
classes <- sapply(initial, class)
data <- read.table(filePath, colClasses = classes, sep = ";", nrows = 100, header = TRUE)

```



#4.Usuwanie wierszy
```{r wiersze}
nrow(data)
res_names_to_remove <- c('UNK', 'UNX', 'UNL', 'DUM', 'N', 'BLOB', 'ALA', 'ARG', 'ASN', 'ASP', 'CYS', 'GLN', 'GLU', 'GLY', 'HIS', 'ILE', 'LEU', 'LYS', 'MET', 'MSE', 'PHE', 'PRO', 'SEC', 'SER', 'THR', 'TRP', 'TYR', 'VAL', 'DA', 'DG', 'DT', 'DC', 'DU', 'A', 'G', 'T', 'C', 'U', 'HOH', 'H20', 'WAT')
data <- filter(data, !res_name %in% res_names_to_remove)
nrow(data)
```



#5.Brakujące dane:
```{r brakujace_dane}

```



#6. Podsumowanie danych:
```{r dane2}
class(data)
dim(data)
object.size(data)
sum(complete.cases(data))
#head(data,n=1)
```

#7. Ograniczenie do 50 najpopularniejszych wartości
```{r ograniczenie}
top50 <- sort(table(data$res_name), decreasing=TRUE)[1:50]
top50names <- names(top50)
top50names
data <- filter(data, res_name %in% top50names)
nrow(data)
```

#8.Korelacja między zmiennymi:
```{r brakujace_dane1}

```

#9. Ile przykładów ma każda klasa
```{r ile_przykladow}
sort(table(data$res_name), decreasing=TRUE)

```

#10.Wykresy:

```{r wykres1}

chart_data_1 <- ggplot(data, aes(x = data$local_res_atom_non_h_count))
chart_layout_1 <- geom_histogram(col = 'blue', fill = 'orange', binwidth = 1)
chart1 <- chart_data_1 + chart_layout_1 + labs(title="Rozkład liczby atomów") + labs(x="Liczba atomów")
chart1

```

```{r wykres2}

chart_data_2 <- ggplot(data, aes(x = data$local_res_atom_non_h_electron_sum))
#chart_layout_2 <- geom_histogram(col = 'blue', fill = 'orange', binwidth = 5)
chart2 <- chart_data_2 + chart_layout_1 + labs(title="Rozkład liczby elektonów") + labs(x="Liczba elektronów")
chart2
```


#11. Analiza klas pod względem niezgodności liczby atomów i elektronów
```{r niezgodnosc}

atoms_incompatibility <- unique(select(data, res_name, local_res_atom_non_h_count, dict_atom_non_h_count))

```

Dodajemy kolumnę z różnicą

```{r niezgodnosc2}

atoms_incompatibility_with_diff <-  mutate(atoms_incompatibility, diff = abs(local_res_atom_non_h_count - dict_atom_non_h_count))

```

Sortujemy

```{r niezgodnosc3}

atoms_incompatibility_with_diff_sorted <- atoms_incompatibility_with_diff[order(-atoms_incompatibility_with_diff$diff),]
head(atoms_incompatibility_with_diff_sorted, 5)

```

Tabela pokazująca 10 klas z największą niezgodnością liczby atomów:

```{r niezgodnosc4}

atoms_table_data <- select(atoms_incompatibility_with_diff_sorted, res_name, diff)[1:10,]
atoms_table_data %>% knitr::kable() %>% kable_styling()


```



#5.Brakujące dane:
```{r brakujace_dane4}

```

#5.Brakujące dane:
```{r brakujace_dane5}

```

#5.Brakujące dane:
```{r brakujace_dane6}

```

#5.Brakujące dane:
```{r brakujace_dane7}

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
